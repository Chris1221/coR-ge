{"name":"coR-ge","tagline":"Software for the Examination of Multiple Correction Methodologies in Accurate Genomic Environments","body":"## Quick-start Guide.\r\n\r\nWelcome to the landing page for **coR-ge** (**cor**ection of **ge**nomes in **R**). This software is in active development, and pull requests are welcome on any of the branches. Please find below instructions for use cases. For more complex use, please contact the maintainer by [raising an issue](https://github.com/Chris1221/sFDR/issues/new) on the project repository.\r\n\r\nThis project was presented at the Compute Canada's High Powered Computer Symposium in June 2015. The [abstract](https://github.com/Chris1221) and [poster PDF](https://github.com/Chris1221) are also found in the repository. \r\n\r\n### Program Structure\r\n\r\nHeuristically, **coR-ge** is structured as follows.  \r\n\r\n\r\n![Logic Flow](https://raw.githubusercontent.com/Chris1221/sFDR/gh-pages/assets/images/logic_flow.png)\r\n\r\nIn reality, these three steps are divided into different files in the repository.  The quick start guide will nonetheless follow this logic flow in order to simplify matters.   \r\n\r\n### Requirements\r\n\r\n**coR-ge** requires the following: \r\n\r\n* This program requires a cluster system set up on either `SGE` or `PBS` architecture, running `qsub`.  It can be easily modified to use `bsub` as well with minimal effort.\r\n* Any base unix system to run on.  The program has been tested on `CentOS` and `OSX`.  Dependency issues should be reported as an [issue](https://github.com/Chris1221/sFDR/issues/new) on the main repository. \r\n* `R` version > 3.0.0 able to run `dplyr` and `data.frame`\r\n* `Rscript` in `$PATH` or located at `/usr/bin/Rscript`\r\n* `Python` v. 2.7.*\r\n* A temporary storage drive with n*560G free space, where n is the number of runs you would like to perform simultaneously. \r\n* 156G RAM recommended. Be aware that improper allocation of jobs can easily cause swapping of nodes on the cluster.  We have included a delayed submission script to ameliorate this problem. \r\n* Latest build of 1000 Genomes in IMPUTE2 format (`*.legend`, `*.haps`, `*.sample`) in any directory that has sufficient storage room.  Name this directory; it will hereafter be named `$REF`\r\n\r\n### Installation \r\n\r\nClone the repository to your working directory (hereafter known as `$WD`):\r\n\r\n    $ cd $WD\r\n    $ git clone https://github.com/Chris1221/sFDR\r\n    $ git checkout master\r\n    $ cd sFDR/\r\n\r\nEnsure that you are on the master branch for now.  \r\n\r\nSeveral files will have to be edited, and these will be addressed in turn. \r\n\r\n### Disease Model\r\n\r\nThe file `rand.R` contains the information for the disease model. We will edit a few things here to specify individual parameters for the run.  At the top of the script, you must edit the following parameters.  Defaults are displayed, and must be edited:\r\n\r\n    heritability <- 0.45\r\n    noise_var <- 0.55\r\n    sim_file_path <- getwd()\r\n    wd <- getwd()\r\n    snp_summary <- \"snp_summary.out\"\r\n\r\nTo filter based on minor allele frequency, you must generate a file named `snp_summary.out` (or whatever you set the file name as in `rand.R`) using SNPTEST2. See [here](https://mathgen.stats.ox.ac.uk/genetics_software/snptest/old/snptest.html#Data_Summaries_) for an example of this.\r\n\r\nIn this script, you can manually or randomly generate causal loci (~ line 160).  If you would like to manually assign variants, choose your SNPs and assign them a column named \"causal\" equal to one, and pass only causal SNPs to the `snps` data frame.  `snps` must contain four columns, an example is given below: \r\n\r\n    rsid chromosomes bp all_maf\r\n    rs_1 1           1  0.30\r\n    rs_2 1           2  0.35\r\n    rs_3 1           3  0.05\r\n\r\nIf the selection of the SNPs is based on some parameter, simply subset the `summary` object to select only causal loci.  In the following simple example, we select 50 random SNPs with minor allele frequency between 0.05 and 0.5 using the `dplyr` library. \r\n\r\n    library(dplyr)\r\n    summary %>%\r\n        filter(all_maf > 0.05) %>% \r\n            filter(all_maf < 0.5) %>% \r\n                sample_n(50) %>% \r\n                    select(rsid, chromosomes, bp, all_maf) -> snps\r\n\r\nIn a more complex situation, one may wish to select a group of genes, selecting one causal variant from each.  In the following example, we import a table of 10 genes with start and end positions, and randomly select one causal variant from each of the genes.  Additional information is retained so that the start and end positions can be used to decide a priority strata for sFDR.\r\n\r\n    #Read in list of genes.  First column is gene name, second is physical start position in bp, third is end position in bp.\r\n    gene_list <- read.table(\"gene_list.txt\", h = T, sep = \"\\t\")\r\n\r\n    #select one random SNP from each gene\r\n    for(i in 1:nrow(gene_list)){\r\n\r\n     name <- paste0(\"gene_\", i)\r\n\r\n     #grab only SNPs within gene boundaries \r\n     summary %>% filter(position > gene_list[[i,2]]) %>% filter(position < gene_list[[i,3]]) %>% select(rsid, chromosome,     position, all_maf) -> gene\r\n     gene$select <- 1\r\n     gene$causal <- 0\r\n\r\n     #grab random snp\r\n     gene[ceiling(runif(1,1,nrow(gene))),\"causal\"] <- 1\r\n     assign(name, gene)\r\n    }\r\n\r\n    genes <- rbind(gene_1, gene_2, gene_3, gene_4, gene_5, gene_6, gene_7, gene_8, gene_9, gene_10)\r\n    \r\n    #or\r\n    #genes <- rbind(ls()[grepl(\"gene_[0-9]\", ls())])\r\n    \r\n    genes %>% filter(causal == 1) -> snps\r\n    \r\n    #clear extra columns\r\n    snps$causal <- NULL\r\n    snps$select <- NULL\r\n\r\nThe previous examples illustrate the concept behind SNP selection, but any selection can be made as long as the correct columns are passed to `snps` prior to the renaming step. \r\n\r\n### Resampling and Model Propagation\r\n\r\nIn `i_array.sh`, `j_array.sh`, and `k_array.sh`, set the `$DIR` variable with the directory where you are storing the reference genotypes. Set the `$OUT` variable for where you would like to house the output. Edit the directives to fit your cluster set-up.\r\n\r\nStart the generation of resampled genotypes with `hapgen2`.  For 30 trials (approximately 1.7 TB of free space required):\r\n\r\n    for i in {1..3}\r\n    do\r\n      for j in {1..10}\r\n      do\r\n        bash i_array $i $j\r\n      done\r\n    done\r\nor\r\n    bash sub_script.sh $i_limit $j_limit\r\nfor ease of use. \r\n\r\nThis will begin the submission of many small jobs.  If any jobs fail on your system, please post the full log file in an issue.\r\n\r\n \r\n    \r\n\r\n","google":"UA-63747419-1","note":"Don't delete this file! It's used internally to help with page regeneration."}