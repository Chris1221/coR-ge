{
    "contents" : "---\ntitle: \"LD Thresholding\"\nauthor: \"Christopher B. Cole\"\ndate: \"June 6, 2016\"\noutput: html_document\n---\n\nAll of the following uses `coRge v0.5.6.9000` as tagged [here](https://github.com/Chris1221/coR-ge/releases/tag/v0.5.6.9000), SHA commit `7148e9e`.\n\n## Introduction\n\nWe take the list of generated causal SNPs ($h^2 = 0.45$, $n = 1000$) and use `plink 1.9` to find all SNPs within a 500kb region which have $R^2 > 0.2$ with any of the causal SNPs. We take the unique entries in this list and note $R^2$. We then sweep through all levels of LD `c(0, 0.2, 0.4, 0.6, 0.8, 0.9, 1)` and correct accordingly:\n\nCorrection function:\n\n```{R, eval = F}\nfor(th in levels(as.factor(strata$ld))){\n\n        message(\"Calculating sFDR and FDR\")\n\n        strata %>%\n          filter(s == 1) %>%\n          mutate(p.adj = p.adjust(P, method = \"BH\")) %>%\n          fdr(., mode = \"ld\", level = th) ->\n          s1\n\n        strata %>%\n          filter(s == 2) %>%\n          mutate(p.adj = p.adjust(P, method = \"BH\")) %>%\n          fdr(.,  mode = \"ld\", level = th) ->\n          s2\n\n        strata %>%\n          mutate(p.adj = p.adjust(P, method = \"BH\")) %>%\n          fdr(., mode = \"ld\", level = th) ->\n          agg\n\n        sfdr <- (s1[1]+s2[1]) / (s1[1]+s2[1] + s1[2]+s2[2])\n        fdr <- agg[3]\n\n        out[nrow(out)+1,] <- c(sfdr, fdr, \"all\", th)\n  }\n```\n\nand `fdr()`:\n\n```{R, eval = F}\nelse if(mode == \"ld\"){\n\n\t\tfp <- sum(!is.na(df$p.adj[(df$p.adj < 0.05 & !(df$h1)) | (df$p.adj < 0.05 & df$ld > level)]))\n\t\ttp <- sum(!is.na(df$p.adj[(df$p.adj < 0.05 & df$h1) | (df$p.adj < 0.05 & df$ld > level)]))\n\t\tfdr <- fp / (tp + fp)\n\n\t}\n\n \treturn(c(fp, tp, fdr))\n```\n\n\n## Results\n#### Omnibus\n\nAfter 30 runs (not all of which finished), we see the following: \n\n```{R, eval = T, echo = F, message = F}\nlibrary(data.table)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(magrittr)\nlibrary(ggvis)\n```\n\n```{R}\nld <- fread(\"~/repos/coR-ge/data/test_run2.txt\", h = T)\nhead(ld)\n```\n\nWe reformat the data from wide to long:\n\n```{R}\nld %<>% gather(key = \"s\", value = \"fdr\", sfdr, fdr)\n\nld$s <- as.factor(ld$s)\nld$k <- as.factor(ld$k)\nld$th <- as.factor(ld$th)\n\nhead(ld)\n\nld.na <- na.omit(ld)\n\nld.na %>% filter(s == \"fdr\") %>% ggvis(~th, ~fdr) %>% layer_boxplots() %>% add_axis(\"x\", title=\"fdr\")\n\nld.na %>% filter(s == \"sfdr\") %>% ggvis(~th, ~fdr) %>% layer_boxplots() %>% add_axis(\"x\", title=\"sfdr\")\n```\n\nAnd perform a regression to examine the differences:\n\n```{R}\nld %>% lm(fdr ~ s + k + th, .) %>% summary\n```\n\nWe can see that stratefied / non stratefied only leads to a small 0.5% decrease in FDR. \n\n#### Pairwise\n\nDespite the fact that as a whole the differences were not significant, in some subsets, the differences are much more pronounced, leading to a difference of between 2 and 3% reduction in FDR. With increased number of trials, this will probably become significant.\n\n```{R}\nld %>% filter(k == 3) %>% filter(th == 0.4) %>% t.test(fdr ~ s, data = .)\n```\n\nIn general, I think that we have too low power to reliably see the difference between FDR and sFDR. Either that, or the 50/50 split is not enough to actually prioritize the results and see a difference.\n\nThis is $n = 5000, h^2 = 0.45$, split = 50 50 causal, 50 50 non-causal.\n\n",
    "created" : 1465205818970.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3686870241",
    "id" : "3D8B8B0B",
    "lastKnownWriteTime" : 1465214225,
    "path" : "~/repos/coR-ge/data/results/LD_report.Rmd",
    "project_path" : "data/results/LD_report.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "type" : "r_markdown"
}